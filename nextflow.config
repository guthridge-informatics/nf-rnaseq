/*
 * -------------------------------------------------
 *  nf-isoseq Nextflow config file
 * -------------------------------------------------
 * Default config options for all environments.
 */

 params {
    reads_pattern    = "*_S*_L00*_R{1,2}_00*.fastq.gz"

    // default reference folder locations
    base                      = "/Volumes/guth_aci_informatics"
    refs                      = "${params.base}/references"
    genomic                   = "${params.refs}/genomic"
    species                   = "${params.genomic}/chimeras"
    sequences                 = "${params.species}/sequences"
    indices                   = "${params.species}/indices"
    miscellaneous             = "${params.refs}/miscellaneous"

    gtf                      = "${params.sequences}/chm13T2Tv2.0/GCF_009914755.1_T2T-CHM13v2.0_genomic.gtf"
    fasta                    = "${params.sequences}/chm13T2Tv2.0/GCF_009914755.1_T2T-CHM13v2.0_genomic.fna"
    star_index               = "${params.indices}/star/chm13T2Tv2.0_star_2.7.10b"
    salmon_index             = "${params.indices}/salmon/gencode_v32_with_viruses_v1.2"

    polyA                    = "${params.miscellaneous}/polyA.fa.gz"
    truseq_adapter           = "${params.miscellaneous}/truseq.fa.gz"
    truseq_rna_adapter       = "${params.miscellaneous}/truseq_rna.fa.gz"
    rRNAs                    = "${params.miscellaneous}/human_ribosomal.fa"

    // default project input and output locations
    project                   = "${params.base}/project"
    raw_data                  = "${params.project}/data/raw_data"
    bcls                      = "${params.raw_data}/bcls"
    raw_fastqs                = "${params.raw_data}/fastqs"
    
    results                   = "${params.project}/data/results"
    qc                        = "${params.results}/qc"
    trimmed                   = "${params.results}/trimmed"
    aligned                   = "${params.results}/aligned"

    logs                      = "${params.project}/logs"
    
    bbmap_xmx                 = "64g"    
    reads                     = "${params.raw_fastqs}/${params.reads_pattern}"
    
    help             = false
    monochrome_logs  = false
}

manifest {
  description     = 'Nextflow RNAseq pipeline'
  author          = 'Miles Smith <miles-smith@omrf.org>'
  mainScript      = 'main.nf'
  nextflowVersion = '>=20.04.1'
  version         = '1.1.1'
}

tower {
  enabled = true
}

timeline {
  enabled = true
  file    = "${params.logs}/execution_timeline.html"
}

report {
  enabled = true
  file    = "${params.logs}/execution_report.html"
}

trace {
  enabled = true
  file    = "${params.logs}/execution_trace.txt"
}

dag {
  enabled = true
  file    = "${params.logs}/pipeline_dag.svg"
}

/* 
 * defines execution profiles for different environments  
 */ 

profiles {
  standard {
    process {
      container   = 'nextflow/rnaseq-nf:latest'
      executor    = "local"
    }
  }
  
  slurm {
    singularity {
      enabled = true
      autoMounts = true
      runOptions = "--bind /Volumes/guth_aci_informatics/"
    }
    process {
      module         = 'singularity'
      executor       = 'slurm'
      queue          = "serial"
      queueSize      = 30
      withName: initial_qc {
          container = "quay.io/biocontainers/falco:1.2.1--h867801b_3"
          maxForks  = 32
          cpus      = 2
          memory    = '4 G'
      }
      withName: perfom_trimming {
          container = "quay.io/biocontainers/bbmap:39.01--h5c4e2a8_0"
          maxForks  = 32
          cpus      = 4
          memory    = '32 G'
      }
      withName: star_align {
          container = "quay.io/biocontainers/star:2.7.10b--h9ee0642_0"
          maxForks  = 32
          cpus      = 16
          memory    = '64 G'
      }
      withName: multiqc {
          container = "ewels/multiqc:1.9"
          maxForks  = 32
          cpus      = 4
          memory    = '32 G'
      }
    }
  }
  
  google {
    docker.enabled    = true
    google {
      location                 = "us-central1"
      zone                     = "us-central1-c"
      project                  = "guthridge-nih-strides-projects"
      lifeSciences.preemptible = true 
    }
    
    workDir          = 'gs://memory-alpha/nextflow'

    process {
      executor       = "google-lifesciences"
      container      = 'nextflow/nextflow:latest'
      machineType    = 'e2-highmem-4'
      cpus           = 4
      withName: initial_qc {
          container = "registry.gitlab.com/milothepsychic/rnaseq_pipeline/fastqc:0.11.9"
          maxForks  = 32
          cpus      = 2
          memory    = '4 G'
      }
      withName: perfom_trimming {
          container = "milescsmith/bbmap:38.96"
          maxForks  = 32
          cpus      = 4
          memory    = '32 G'
      }
      withName: salmon_quant {
          container = "combinelab/salmon:1.3.0"
          maxForks  = 32
          cpus      = 16
          memory    = '4 G'
      }
      withName: multiqc {
          container = "ewels/multiqc:1.9"
          maxForks  = 32
          cpus      = 4
          memory    = '32 G'
      }
      withName: compress_salmon_results {
          container = "rtibiocloud/pigz:v2.4_b243f9"
          maxForks  = 32
          cpus      = 4
          memory    = '2 G'
      }
    }
  }  

  conda {
    process.conda = "${params.project}/conda.yml"
  }

}